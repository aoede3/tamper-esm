{"version":3,"sources":["../../../../encoders/js/env/browser.ts"],"names":["beginByte"],"mappings":"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","file":"browser.js","sourcesContent":["class BitsyLite {\n  length: number;\n  bytes: Uint8Array;\n\n  constructor(size: number) {\n    this.length = size;\n    this.bytes = new Uint8Array(Math.ceil(size / 8));\n  }\n\n  set(index: number, value: boolean) {\n    const byteIndex = (index / 8) | 0;\n    const bitOffset = 7 - (index % 8);\n    const mask = 1 << bitOffset;\n    if (value) {\n      this.bytes[byteIndex] |= mask;\n    } else {\n      this.bytes[byteIndex] &= ~mask;\n    }\n  }\n\n  setSize(size: number) {\n    if (size <= this.length) return;\n    const next = new Uint8Array(Math.ceil(size / 8));\n    next.set(this.bytes);\n    this.bytes = next;\n    this.length = size;\n  }\n\n  slice(begin: number, end: number) {\n    const length = Math.max(0, end - begin);\n    const result = new BitsyLite(length);\n\n    // Fast path: byte-aligned slice\n    if (begin % 8 === 0 && length % 8 === 0) {\n      const beginByte = begin / 8;\n      const numBytes = length / 8;\n      result.bytes.set(this.bytes.subarray(beginByte, beginByte + numBytes));\n      return result;\n    }\n\n    // Optimized path: copy aligned bytes with bit shifting\n    const beginByte = (begin / 8) | 0;\n    const beginBitOffset = begin % 8;\n    const endByte = ((end - 1) / 8) | 0;\n    const numSourceBytes = endByte - beginByte + 1;\n\n    if (beginBitOffset === 0) {\n      // Begin is byte-aligned, just copy bytes\n      const bytesToCopy = Math.ceil(length / 8);\n      result.bytes.set(this.bytes.subarray(beginByte, beginByte + bytesToCopy));\n    } else {\n      // Need to shift bits\n      const shift = beginBitOffset;\n      for (let i = 0; i < numSourceBytes - 1; i += 1) {\n        const currentByte = this.bytes[beginByte + i];\n        const nextByte = this.bytes[beginByte + i + 1];\n        result.bytes[i] = ((currentByte << shift) | (nextByte >> (8 - shift))) & 0xff;\n      }\n      // Handle last byte\n      if (numSourceBytes > 0) {\n        const lastSourceByte = this.bytes[beginByte + numSourceBytes - 1];\n        const resultByteIndex = numSourceBytes - 1;\n        if (resultByteIndex < result.bytes.length) {\n          result.bytes[resultByteIndex] = (lastSourceByte << shift) & 0xff;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  getBuffer(): Uint8Array {\n    return this.bytes;\n  }\n}\n\nfunction toBase64(bytes: Uint8Array): string | undefined {\n  if (!bytes || !bytes.length) return undefined;\n\n  if (typeof Buffer !== \"undefined\") {\n    return Buffer.from(bytes).toString(\"base64\");\n  }\n\n  if (typeof btoa === \"function\") {\n    let binary = \"\";\n    const chunkSize = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunkSize) {\n      const chunk = bytes.subarray(i, i + chunkSize);\n      binary += String.fromCharCode.apply(null, chunk as unknown as number[]);\n    }\n    return btoa(binary);\n  }\n\n  throw new Error(\"No base64 encoder available.\");\n}\n\nexport default {\n  createBuffer(length: number): Uint8Array {\n    return new Uint8Array(length);\n  },\n  writeUInt32BE(buffer: Uint8Array, value: number, offset: number): void {\n    const view = new DataView(\n      buffer.buffer,\n      buffer.byteOffset,\n      buffer.byteLength,\n    );\n    view.setUint32(offset, value, false);\n  },\n  writeUInt8(buffer: Uint8Array, value: number, offset: number): void {\n    buffer[offset] = value & 0xff;\n  },\n  concatBuffers(chunks: Uint8Array[]): Uint8Array {\n    let total = 0;\n    chunks.forEach((chunk) => {\n      total += chunk.length;\n    });\n\n    const out = new Uint8Array(total);\n    let offset = 0;\n    chunks.forEach((chunk) => {\n      out.set(chunk, offset);\n      offset += chunk.length;\n    });\n\n    return out;\n  },\n  toBase64,\n  createBitset(size: number) {\n    return new BitsyLite(size);\n  },\n};\n"]}